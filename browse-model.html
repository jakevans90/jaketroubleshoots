<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Browse by Model - Jake Troubleshoots</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Jake Troubleshoots</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="guides.html">Guides</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<section class="hero">
  <h2>Browse Guides by Model</h2>
  <p>Find troubleshooting guides organized by equipment model.</p>
</section>

<section class="browse-section">
  <h3>Models</h3>
  <div id="model-buttons" class="browse-buttons">
    <!-- Buttons injected dynamically -->
  </div>
</section>

<section id="guides-grid" class="guides-grid" style="padding:40px; display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px;">
  <!-- Guide cards injected dynamically -->
</section>

<footer>
  <p>Contact: <a href="mailto:contact@jaketroubleshoots.com" style="color:#8fff00;">contact@jaketroubleshoots.com</a></p>
  <p>Guides intended for trained personnel only.</p>
  <p>© 2026 Jake Troubleshoots</p>
</footer>

<script>
fetch('data/guides.json') // updated path
  .then(res => {
    if (!res.ok) throw new Error('Could not load guides.json');
    return res.json();
  })
  .then(jsonData => {
    const isFileList = Array.isArray(jsonData) && typeof jsonData[0] === 'string';

    if (isFileList) {
      // guides.json contains a list of filenames → fetch all
      return Promise.all(
        jsonData.map(file =>
          fetch(file).then(res => {
            if (!res.ok) throw new Error('Could not load ' + file);
            return res.json();
          })
        )
      ).then(allData => allData.flat());
    } else {
      // guides.json already contains guide objects
      return jsonData;
    }
  })
  .then(allGuides => {
    const container = document.getElementById('guides-grid');
    const buttonsContainer = document.getElementById('model-buttons');

    if (!container || !buttonsContainer) throw new Error('Required containers not found');

    // Create unique sorted list of models
    const models = [...new Set(allGuides.map(g => g.model))].sort();

    // Create buttons for each model
    models.forEach(model => {
      const btn = document.createElement('a');
      btn.href = '#';
      btn.textContent = model;
      btn.classList.add('browse-button'); // optional: for CSS styling
      btn.addEventListener('click', e => {
        e.preventDefault();
        showGuidesByModel(model);
      });
      buttonsContainer.appendChild(btn);
    });

    // Function to display guides filtered by model
    function showGuidesByModel(model) {
      container.innerHTML = '';
      const filtered = allGuides
        .filter(g => g.model === model)
        .sort((a, b) => a.title.localeCompare(b.title));

      filtered.forEach(guide => {
        const card = document.createElement('a');
        card.href = guide.url;
        card.classList.add('guide-card');

        card.innerHTML = `
          <div class="card-content">
            <h3>${guide.title}</h3>
            <p>${guide.description}</p>
            <div class="badges">
              <span class="badge asset">${guide.assetType}</span>
              <span class="badge manufacturer">${guide.manufacturer}</span>
              <span class="badge model">${guide.model}</span>
            </div>
            <p class="date"><em>Date Added: ${guide.dateAdded}</em></p>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Show the first model guides by default
    if (models.length > 0) showGuidesByModel(models[0]);
  })
  .catch(err => console.error('Guide load error:', err));
</script>

</body>
</html>
