<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jake Troubleshoots</title>
  <link rel="stylesheet" href="style.css">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="icon" type="image/png" href="images/favicon.png"> <!-- optional PNG fallback -->

  <style>
    /* Inline styles for hero search bar */
    #home-search-form {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 5px;
      flex-wrap: wrap;
    }

    #home-search-input {
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 300px;
      min-width: 200px;
      box-sizing: border-box;
    }

    #home-search-form button {
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background: #111;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    #home-search-form button:hover {
      background: #333;
    }
  </style>
</head>
<body>

<header>
  <a href="index.html" class="site-logo">
    <img src="images/logo.png" alt="Jake Troubleshoots Logo" class="site-icon">
    <span class="logo-text">Jake Troubleshoots</span>
  </a>

  <nav>
    <a href="index.html">Home</a>
    <a href="guides.html">Guides</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<section class="hero">
  <h2>Built for Clinical Engineers. Focused on Fixing Equipment.</h2>
  <p>A growing library of clinical engineering troubleshooting guides — organized by asset type, manufacturer, and model.</p>

  <!-- Search bar -->
  <form id="home-search-form">
    <input type="text" id="home-search-input" placeholder="Search guides...">
    <button type="submit">Search</button>
  </form>

  <a href="guides.html" style="display:inline-block; margin-top:20px;">Browse All Guides</a>
</section>

<section class="browse-section">
  <h3>Browse By</h3>
  <div class="browse-buttons">
    <a href="browse-asset.html">Asset Type</a>
    <a href="browse-manufacturer.html">Manufacturer</a>
    <a href="browse-model.html">Model</a>
  </div>
</section>

<section style="padding:40px; text-align:center;">
  <h3>Most Recent Guides</h3>
  <div id="guides-grid" class="guides-grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; justify-items:center;">
    <!-- Cards will be injected here by JS -->
  </div>
</section>

<footer>
  <p>Contact: <a href="mailto:contact@jaketroubleshoots.com" style="color:#8fff00;">contact@jaketroubleshoots.com</a></p>
  <p>Guides intended for trained personnel only.</p>
  <p>© 2026 Jake Troubleshoots</p>
</footer>

<script>
// Load and display recent guides
fetch('data/guides.json')
  .then(res => {
    if (!res.ok) throw new Error('Could not load guides.json');
    return res.json();
  })
  .then(jsonData => {
    const isFileList = Array.isArray(jsonData) && typeof jsonData[0] === 'string';
    if (isFileList) {
      return Promise.all(
        jsonData.map(file =>
          fetch(file).then(res => {
            if (!res.ok) throw new Error('Could not load ' + file);
            return res.json();
          })
        )
      ).then(allData => allData.flat());
    } else {
      return jsonData;
    }
  })
  .then(allGuides => {
    const recentGuides = allGuides
      .sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded))
      .slice(0, 6);

    const container = document.getElementById('guides-grid');
    if (!container) throw new Error('#guides-grid not found');

    recentGuides.forEach(guide => {
      const card = document.createElement('a');
      card.href = guide.url;
      card.classList.add('guide-card');

      card.innerHTML = `
        <div class="card-content">
          <h3>${guide.title}</h3>
          <p>${guide.description}</p>
          <div class="badges">
            <span class="badge asset">${guide.assetType}</span>
            <span class="badge manufacturer">${guide.manufacturer}</span>
            <span class="badge model">${guide.model}</span>
          </div>
          <p class="date"><em>Date Added: ${guide.dateAdded}</em></p>
        </div>
      `;
      container.appendChild(card);
    });
  })
  .catch(err => console.error('Guide load error:', err));

// Homepage search bar redirect
const form = document.getElementById('home-search-form');
form.addEventListener('submit', e => {
  e.preventDefault();
  const query = document.getElementById('home-search-input').value.trim();
  if(query) {
    window.location.href = `search.html?q=${encodeURIComponent(query)}`;
  }
});
</script>

</body>
</html>
